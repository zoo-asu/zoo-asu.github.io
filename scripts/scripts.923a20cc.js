"use strict";angular.module("yvyUiApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","angularUtils.directives.dirPagination"]).config(["$routeProvider",function(a){a.when("/mapa",{templateUrl:"views/mapa_zoo_asu.html",activetab:"mapa"}).when("/datos",{templateUrl:"views/data_list.html",controller:"DataTableCtrl",activetab:"datos"}).when("/about-us",{templateUrl:"views/about-us.html",activetab:"about"}).when("/",{templateUrl:"views/main.html",activetab:"home"}).otherwise({redirectTo:"/mapa"})}]),angular.module("yvyUiApp").controller("ActiveTabCtrl",["$scope","$route",function(a,b){a.route=b}]),angular.module("yvyUiApp").controller("DataTableCtrl",["$scope","zooAsuFactory",function(a,b){b.getAnimalesList().then(function(b){a.animales=b}),a.pagesize=15,a.sortType="nombre",a.sortReverse=!1,a.search={},a.activateSortCol=function(b){a.sortType==b?a.sortReverse=!a.sortReverse:(a.sortType=b,a.sortReverse=!1)}}]),angular.module("yvyUiApp").controller("FilterCtrl",["$scope","zooAsuFactory","$route",function(a,b,c){a.nombre_animal="";var d={banho:!1,agua:!1,asiento:!1,estacionamiento:!1,guardaparque:!1,museo:!1,areadescanso:!1};a.poi_hash=d,a.togglePOIFilter=function(a){for(var c in d)d.hasOwnProperty(c)&&(c===a?d[c]=!d[c]:d[c]=!1);b.filtrarMapa(e())},a.updateMap=function(){a.nombre_animal.length>2&&b.filtrarMapa(e())};var e=function(){var b;for(var c in d)if(d.hasOwnProperty(c)&&d[c]===!0){b=c;break}return{nombre_animal:a.nombre_animal,poi:b}}}]),angular.module("yvyUiApp").factory("zooAsuFactory",["$http","$filter","$rootScope",function(a,b,c){return{getCentroZoo:function(){return{geometry:{coordinates:[-25.25032,-57.5721],type:"Point"},properties:{},type:"Feature"}},getGeojson:function(){return a.get("data/zoo-as.geojson").then(function(a){return c.allFeatures=a.data,a.data})},getAnimales:function(){return a.get("data/animales.json").then(function(a){return a.data})},getAnimalesList:function(){return a.get("data/animals_list.json").then(function(a){return a.data})},filtrarMapa:function(a){var d=function(a,b,c){return a.properties[b]===c},e=c.allFeatures,f=b("filter")(e.features,function(b,c,e){if(a.nombre_animal>2&&"attraction"===b.properties.tourism&&a.nombre_animal===b.properties.name)return!0;switch(a.poi){case"banho":return d(b,"amenity","toilets");case"agua":return d(b,"amenity","drinking_water");case"asiento":return d(b,"amenity","bench");case"estacionamiento":return d(b,"amenity","parking");case"guardaparque":return d(b,"amenity","ranger_station");case"museo":return d(b,"tourism","museum");case"areadescanso":return d(b,"highway","rest_area")}return!1}),g={type:"FeatureCollection",features:f};c.$broadcast("mapa.filtrado",g)}}}]),angular.module("yvyUiApp").directive("mapaZooAsu",["zooAsuFactory","$timeout",function(a,b){return{restrict:"E",replace:!1,scope:{data:"=",filtro:"=",detalle:"=",periodo:"=",modal:"="},templateUrl:"views/directives/template_mapa.html",link:function(b,c,d){function e(a){var b,c,d="glyphicon";if(a.properties.hasOwnProperty("amenity"))switch(a.properties.amenity){case"bench":c="darkpurple",b="download";break;case"waste_basket":c="black",b="trash";break;case"drinking_water":c="blue",b="tint";break;case"toilets":c="darkgreen",b="asterisk";break;case"parking":c="red",b="unchecked";break;case"ranger_station":c="darkred",b="info-sign";break;default:c="orange",b="home"}if(a.properties.hasOwnProperty("highway"))switch(a.properties.highway){case"rest_area":c="orange",b="tree-deciduous";break;default:c="orange",b="home"}if(a.properties.hasOwnProperty("tourism"))switch(a.properties.tourism){case"museum":c="blue",b="tower";break;default:c="darkred",b="info-sign"}return L.AwesomeMarkers.icon({icon:b,markerColor:c,prefix:d})}function f(a){try{return"Polygon"==a.geometry.type&&"attraction"==a.properties.tourism}catch(b){return!1}}function g(a){var b=L.polygon(a.geometry.coordinates);if("undefined"!=typeof a.properties.name){var c=b.getBounds().getCenter();c=j(c),L.marker(c,{icon:L.divIcon({className:"leaflet-label",html:a.properties.name,iconSize:[100,40]})}).addTo(E)}}function h(a){if("undefined"!=typeof a.properties.amenity)switch(a.properties.amenity){case"parking":return s;case"toilets":return t;case"water_point":return u;case"ranger_station":return x}else if("undefined"!=typeof a.properties.tourism)switch(a.properties.tourism){case"attraction":case"theme_park":return q;case"zoo":return v;case"museum":return x}else if("undefined"!=typeof a.properties.natural)switch(a.properties.natural){case"wood":case"grassland":case"tree":case"tree_row":return w;case"water":return u}else if("undefined"!=typeof a.properties.landuse)switch(a.properties.landuse){case"grass":case"meadow":return w}else if("undefined"!=typeof a.properties.building)switch(a.properties.building){case"school":case"yes":case"public":return x}else if("undefined"!=typeof a.properties.highway)switch(a.properties.highway){case"rest_area":return r;case"path":case"footway":case"road":return y;case"service":case"unclassified":return z}else{if("undefined"!=typeof a.properties.barrier)return A;if("undefined"!=typeof a.properties.attraction)switch(a.properties.highway){case"animal":return x}}return{color:"#ff0000",fillColor:"#ff0000",weight:4}}function i(a){var b=h(a);return{color:b.color,fillColor:b.fillColor,weight:b.weight,fillOpacity:B,dashArray:"3",opacity:1,html:"cualquier cosa"}}function j(a){var b=a.lat;return a.lat=a.lng,a.lng=b,a}var k=function(){D.tilesLoaded=!0,o()},l=function(){function c(a,b){b.on({click:d})}function d(a){var c=!1;angular.forEach(m,function(d){a.target.feature.id===d.geojson_id&&(b.modal=d,c=!0)}),b.$apply(),c&&$("#descripcion-modal").modal("show"),console.log("La unidad cliqueada tiene el identificador: "+a.target.feature.id)}n();var f=D.LAYERS(),g=f.OPEN_STREET_MAPS.on("load",k),h=(f.MAPQUEST.on("load",k),f.CARTODB.on("load",k)),j=L.map("map",{maxZoom:D.zoomMax,minZoom:D.zoomMin,worldCopyJump:!0,attributionControl:!1}).setView(a.getCentroZoo().geometry.coordinates,D.zoomMin).on("baselayerchange",n),l=a.getGeojson();D.all_features=a.getGeojson(),b.allFeatures=D.all_features,l.then(function(a){L.geoJson(a,{pointToLayer:function(a,b){return L.marker(b,{icon:e(a)})},style:function(a){return i(a)},onEachFeature:c,filter:function(a,b){return"tree"==a.properties.natural?!1:"drystream"==a.properties.waterway?!1:"camp_site"==a.properties.tourism?!1:-1!=a.id.indexOf("node/")?!1:"stream"==a.properties.waterway?!1:!0}}).addTo(j),D.geoJsonFeatures=a});var m=[];a.getAnimales().then(function(a){m=a});var o={"Calles OpenStreetMap":g,"Blanco y Negro":h};return j.addLayer(g),L.control.layers(o).addTo(j),j},m=_.throttle(function(a){if(E.getZoom()>=D.zoomMax){if(!C){var b=D.all_features,c=E.getBounds();b.then(function(a){_.filter(a.features,function(a){var b=[a.geometry.coordinates[1],a.geometry.coordinates[0]];return c.contains(b)}),_.each(a.features,function(a){f(a)&&g(a)})}),C=!0}}else C&&(E.eachLayer(function(a){"undefined"!=typeof a._icon&&a._icon.className.indexOf("leaflet-label")>-1&&E.removeLayer(a)}),C=!1)},200),n=function(){},o=function(){},p=function(){var a=L.geoJson();D.geoJsonLayer=a,D.geoJsonLayer.on("mouseover",function(a){}),D.geoJsonLayer.addTo(E),E.on("move",m)},q={color:"#6f4e37",fillColor:"#6f4e37",weight:3},r={color:"#f09109",fillColor:"#f09109",weight:3},s={color:"#ff0000",fillColor:"#ff0000",weight:3},t={color:"#0b3b0b",fillColor:"#0b3b0b",weight:3},u={color:"#1c86c6",fillColor:"#1c86c6",weight:3},v={color:"#079109",fillColor:"#079109",weight:5},w={color:"#079109",fillColor:"#079109",weight:3},x={color:"#900c3f",fillColor:"#900c3f",weight:3},y={color:"#aba8a4",fillColor:"#aba8a4",weight:3},z={color:"#8c8a87",fillColor:"#8c8a87",weight:5},A={color:"#61210b",fillColor:"#61210b",weight:3},B="0.3",C=!1,D=D||{};D.tilesLoaded=!1,D.zoomMin=17,D.zoomMax=20,D.filteredGeoJsonLayer=void 0,D.LAYERS=function(){var a=L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3}),b=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}),c=L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.{ext}",{type:"sat",ext:"jpg",attribution:'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency',subdomains:"1234"});return{OPEN_STREET_MAPS:a,MAPQUEST:c,CARTODB:b}};var E=l();p(),b.$on("mapa.filtrado",function(a,b){b.features=_.map(b.features,function(a){if("Polygon"==a.geometry.type){var b=L.polygon(a.geometry.coordinates),c=j(b.getBounds().getCenter());a.geometry.type="Point",a.geometry.coordinates=[c.lng,c.lat]}return a});var c=L.geoJson(b,{pointToLayer:function(a,b){return L.marker(b,{icon:e(a)})}});D.filteredGeoJsonLayer&&E.removeLayer(D.filteredGeoJsonLayer),D.filteredGeoJsonLayer=c,c.addTo(E)})}}}]);